---
title: 小程序开发-云开发模糊搜索
date: 2019-5-23 17:29:12
categories:
    - 小程序
tags: 
    - 小程序
mathjax: true
---

### 需求
在这里我们要实现一个数据库的搜索功能。但在实际中我们的用户很可能自己并不明白要搜索什么，并且很可能通过关键词来进行索引。所以要解决的问题是：

*   如果在数据库的所有条目中找到目标的匹配处理
*   如何进行模糊搜索
<!--more-->
### 实现

从基础库 2.3.2 开始可以在查询语句中使用 JavaScript 原生正则对象或使用 **db.RegExp** 方法来构造正则对象然后进行字符串匹配。在查询条件中对一个字段进行正则匹配即要求该字段的值可以被给定的正则表达式匹配.

**注意正则表达式不可用于 db.command 内（如 [db.command.in](http://db.command.in)）。**

db.RegExp 定义如下：

```JavaScript
function RegExp(initOptions: IInitOptions): DBRegExp

interface IInitOptions {
  regexp: string // 正则表达式，字符串形式
  options: string // flags，包括 i, m, s 但前端不做强限制
}
```

options 支持 i, m, s 这四个 flag，注意 JavaScript 原生正则对象构造时仅支持其中的 i, m 两个 flag，因此需要使用到 s 这个 flag 时必须使用 db.RegExp 构造器构造正则对象。flag 的含义见下表：

<table>
<thead>
<tr>
<th>flag</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>大小写不敏感</td>
</tr>
<tr>
<td>m</td>
<td>跨行匹配；让开始匹配符 ^ 或结束匹配符 $ 时除了匹配字符串的开头和结尾外，还匹配行的开头和结尾</td>
</tr>
<tr>
<td>s</td>
<td>让 . 可以匹配包括换行符在内的所有字符</td>
</tr>
</tbody>
</table>

我们可以使用来进行模糊搜索。

```JavaScript
//js
 db.collection('taskOngoing')
          .skip(20)
          .limit(that.data.pageSize)
          .where({
            briefInf: db.RegExp({
              regexp: this.data.sinput,
              options: 's',
            })
          })
```